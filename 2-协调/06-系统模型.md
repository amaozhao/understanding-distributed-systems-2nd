# 系统模型

为了理解分布式系统，我们需要准确定义什么可以发生，什么不能发生。系统模型对流程行为、通信链接和时间的预期进行编码；将其视为一组假设，允许我们通过忽略用于实现分布式系统的实际技术的复杂性来理解分布式系统。

例如，这些是通信链路的一些常见模型：

- 公平损失链接模型假设消息可能会丢失和重复，但如果发送者不断重传消息，最终它会被传递到目的地。
- 可靠链接模型假设消息只传递一次，不会丢失或重复。通过在接收端删除重复消息，可以在公平丢失链路之上实现可靠链路。
- 认证的可靠链路模型与可靠链路的假设相同，但另外假设接收方可以认证发送方。

尽管这些模型只是对真实通信链路的抽象，但它们对于验证算法的正确性很有用。而且，正如我们在前几章中所看到的，可以在公平损失的基础上建立可靠且经过身份验证的通信链路。例如，TCP 实现了可靠传输（等等），而 TLS 实现了身份验证（等等）。

同样，我们可以根据预期发生的故障类型对流程的行为进行建模：

- 任意故障模型假设进程可以以任意方式偏离其算法，从而导致由错误或恶意活动引起的崩溃或意外行为。由于历史原因，这种模式也被称为"拜占庭"模式。更有趣的是，理论上可以证明使用该模型的系统最多可以容忍 1/3  故障进程[^1] 并且仍然正常运行。
- 崩溃恢复模型假设进程不会偏离其算法，但可以随时崩溃并重新启动，从而失去其内存状态。
- 崩溃停止模型假设一个进程不会偏离它的算法，但如果它崩溃了也不会重新上线。尽管这对于软件崩溃来说似乎不切实际，但它模拟了不可恢复的硬件故障，并且通常使算法更简单。

任意故障模型通常用于对安全关键系统（如飞机发动机、核电站）和单个实体无法完全控制所有过程的系统（例如比特币等数字加密货币）进行建模。这些用例超出了本书的范围，这里介绍的算法通常会假设一个崩溃恢复模型。

最后，我们还可以对时序假设进行建模：

- 同步模型假定发送消息或执行操作永远不会超过一定的时间。这对于我们关心的系统类型来说是不太现实的，我们知道通过网络发送消息可能需要很长时间，并且进程可能会因垃圾收集周期或页面错误等原因而减慢。
- 异步模型假定发送消息或对进程执行操作可能需要无限时间。不幸的是，在这种假设下，很多问题都无法解决；如果发送消息可能需要无限长的时间，算法可能会卡住并且根本没有任何进展。尽管如此，这个模型还是很有用的，因为它比做出时序假设的模型更简单，因此基于它的算法也更容易实现[^2]。
  部分同步模型假设系统大部分时间都是同步运行的。该模型通常足以代表现实世界的系统。
- 在本书的其余部分，我们通常会假设一个具有公平损失链接、崩溃恢复过程和部分同步的系统模型。如果你对其他系统模型感到好奇并想了解更多关于其他系统模型的信息，《可靠和安全分布式编程简介》[^3] 是一本优秀的理论书籍，它探讨了本文未考虑的各种模型的分布式算法。

但请记住，模型只是现实[^4]的抽象，因为它们并不代表真实世界的所有细微差别。 因此，当您继续阅读时，质疑模型的假设并尝试想象依赖它们的算法如何在实践中崩溃。

----------------------------

[1] "拜占庭将军问题"，https://lamport.azurewebsites.net/pubs/byz.pdf

[2] "可靠分布式系统的不可靠故障检测器"，https://www.cs.utexas.edu/~lorenzo/corsi/cs380d/papers/p225-chandra.pdf

[3] "可靠和安全的分布式编程简介"，https://www.distributedprogramming.net/

[4] "所有模型都是错误的"，https://en.wikipedia.org/wiki/All_models_are_wrong